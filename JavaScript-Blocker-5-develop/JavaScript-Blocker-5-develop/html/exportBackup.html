<!--
JS Blocker 5 (http://jsblocker.toggleable.com) - Copyright 2017 Travis Lee Roman
-->

<!DOCTYPE html>

<html>
	<head>
		<meta charset="utf-8" />
		
		<title>JS Blocker Backup</title>
		
		<script src="../js/global/jquery.js"></script>
		<script src="../js/safari.js"></script>
		<script src="../js/promise.js"></script>
		<script src="../js/utilities.js"></script>
		<script src="../js/event.js"></script>
		<script src="../js/store.js"></script>

		<script>
			document.addEventListener('DOMContentLoaded', function () {
				if (Utilities.safariBuildVersion >= 603) {
					var anchor = $('#export-download');

					anchor.click(function () {
						setTimeout(function () {
							window.close();
						}, 500);
					});

					anchor.attr('href', Utilities.URL.createFromContent(GlobalCommand('exportedBackup'), 'application/json', false));
				} else {
					var iframe = document.getElementById('export');

					iframe.src = Utilities.URL.createFromContent(GlobalCommand('exportedBackup'), 'application/zip', true);

					setTimeout(function () {
						window.close();
					}, 1500);
				}
			}, true);
		</script>

		<style type="text/css">
			html {
				font-family: -apple-system;
			}

			iframe {
				visibility: hidden;
			}
		</style>
	</head>
	<body>
		<p class="jsb-info">Your JSB backup is ready: <a id="export-download" href="javascript:void(0);" download="JSB-Backup.json">Download Backup</a></p>

		<iframe id="export"></iframe>
	</body>
</html>
